<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InstaBooster - PRO</title>
    
    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #050505; --primary: #00f3ff; --secondary: #ff00ff; --card-bg: rgba(20, 20, 30, 0.85); }
        * { box-sizing: border-box; }
        body { background-color: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* --- BACKGROUND --- */
        .universe-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at top, #1a0b2e 0%, #000000 90%); z-index: -2; }
        .neon-grid { position: fixed; bottom: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px); background-size: 30px 30px; transform: perspective(300px) rotateX(45deg); z-index: -1; pointer-events: none; }

        /* --- HEADER --- */
        .app-header { height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; background: rgba(5,5,10,0.95); backdrop-filter: blur(5px); border-bottom: 1px solid #222; flex-shrink: 0; z-index: 100; }
        .app-content { flex: 1; overflow-y: auto; padding: 10px 15px 80px 15px; }
        .app-content::-webkit-scrollbar { display: none; }

        /* --- CARDS & INPUTS --- */
        .cyber-card { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); border-bottom: 2px solid var(--primary); border-radius: 12px; padding: 12px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 100%; transition: transform 0.2s; }
        .neon-input { background: rgba(0,0,0,0.5); border: 1px solid #333; color: #fff !important; padding: 10px; width: 100%; border-radius: 6px; margin-bottom: 8px; font-weight: 600; font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; transition: 0.3s; }
        .neon-input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,243,255,0.2); outline: none; }
        .btn-cyber { background: linear-gradient(90deg, var(--primary), #0088ff); border: none; color: #000; font-weight: 800; padding: 10px; width: 100%; border-radius: 50px; font-family: 'Orbitron', sans-serif; letter-spacing: 1px; font-size: 0.85rem; text-transform: uppercase; box-shadow: 0 0 15px rgba(0,243,255,0.4); }
        .btn-cyber:active { transform: scale(0.98); }

        /* --- QR SCANNER ANIMATION --- */
        .qr-frame { position: relative; padding: 5px; background: rgba(0,0,0,0.5); border: 1px solid var(--primary); border-radius: 10px; display: inline-block; box-shadow: 0 0 15px rgba(0,243,255,0.1); }
        .qr-scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: var(--secondary); box-shadow: 0 0 10px var(--secondary); animation: scan 2s linear infinite; opacity: 0.8; }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        /* --- 3D FUND ITEM --- */
        .fund-item { background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border-left: 3px solid #333; padding: 12px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; transform: perspective(500px) rotateX(0deg); transition: 0.3s; }
        .fund-item:hover { transform: perspective(500px) translateZ(10px); background: rgba(255,255,255,0.05); }
        .fund-item.approved { border-left-color: #00ff88; box-shadow: -5px 0 10px rgba(0,255,136,0.1); }
        .fund-item.pending { border-left-color: #ffcc00; }
        .fund-item.rejected { border-left-color: #ff0055; }

        /* --- NAV --- */
        .nav-dock { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; height: 60px; background: rgba(15, 15, 20, 0.95); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; box-shadow: 0 5px 20px rgba(0,0,0,0.8); }
        .nav-item { font-size: 1.3rem; color: #666; background: none; border: none; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); text-shadow: 0 0 10px var(--primary); }

        /* --- UTILS --- */
        .font-tech { font-family: 'Orbitron', sans-serif; }
        .text-glow { color: var(--primary); text-shadow: 0 0 8px rgba(0, 243, 255, 0.6); }
        .text-pink { color: var(--secondary); text-shadow: 0 0 8px rgba(255, 0, 255, 0.6); }
        .screen { display: none; width: 100%; height: 100%; }
        .screen.active { display: block; }
        .stats-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .stats-col { flex: 1; }
    </style>
</head>
<body>
    <div class="universe-bg"></div>
    <div class="neon-grid"></div>

    <!-- AUTH SCREEN -->
    <div id="scr-auth" class="screen active" style="position:fixed; top:0; left:0; z-index:2000; background:var(--bg); overflow-y:auto;">
        <div class="vh-100 d-flex align-items-center justify-content-center p-4">
            <div class="cyber-card text-center" style="max-width: 380px; border-bottom: 2px solid var(--secondary);">
                <h1 class="font-tech mb-4" style="font-size: 2rem;">INSTA<span class="text-glow">BOOSTER</span></h1>
                <div id="box-login">
                    <input type="email" id="l-mail" class="neon-input" placeholder="EMAIL ADDRESS">
                    <input type="password" id="l-pass" class="neon-input" placeholder="PASSWORD">
                    <button class="btn-cyber mt-3" onclick="login()">LOGIN NOW</button>
                    <div class="mt-4 text-white-50 small" onclick="togAuth('reg')">Don't have account? <b class="text-pink">Sign Up</b></div>
                </div>
                <div id="box-reg" style="display:none;">
                    <input type="email" id="r-mail" class="neon-input" placeholder="NEW EMAIL">
                    <input type="password" id="r-pass" class="neon-input" placeholder="NEW PASSWORD">
                    <button class="btn-cyber mt-3" style="filter: hue-rotate(120deg);" onclick="register()">CREATE ACCOUNT</button>
                    <div class="mt-4 text-white-50 small" onclick="togAuth('log')">Already member? <b class="text-glow">Login</b></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP SCREEN -->
    <div id="scr-app" class="screen" style="display:flex; flex-direction:column; height:100vh;">
        <div class="app-header">
            <div class="font-tech fw-bold" style="font-size: 1.1rem;">INSTA<span class="text-glow">BOOSTER</span></div>
            <i class="fas fa-power-off text-danger" onclick="auth.signOut()" style="font-size:1.2rem; padding: 5px;"></i>
        </div>

        <div class="app-content">
            <!-- HOME TAB -->
            <div id="tab-home" class="tab-view" style="display:block;">
                
                <!-- NEW: USER EMAIL DISPLAY -->
                <div class="cyber-card text-center py-2 mb-2" style="border-bottom: 2px solid var(--secondary);">
                    <small class="text-white-50 font-tech" style="font-size:0.65rem; letter-spacing:1px;">CURRENT USER</small>
                    <div class="d-flex justify-content-center align-items-center mt-1">
                        <i class="fas fa-user-astronaut text-primary me-2"></i>
                        <h6 class="m-0 text-white font-tech" id="d-email">Loading...</h6>
                    </div>
                </div>

                <!-- Stats Row -->
                <div class="stats-row">
                    <div class="stats-col"><div class="cyber-card text-center py-2 mb-0"><small class="text-secondary font-tech" style="font-size:0.65rem;">BALANCE</small><h3 class="m-0 text-glow" id="d-bal">₹0</h3></div></div>
                    <div class="stats-col"><div class="cyber-card text-center py-2 mb-0"><small class="text-secondary font-tech" style="font-size:0.65rem;">SPENT</small><h3 class="m-0 text-pink" id="d-spent">₹0</h3></div></div>
                </div>

                <!-- Order Form -->
                <div class="cyber-card">
                    <h6 class="font-tech text-white mb-2" style="font-size: 0.9rem;"><i class="fas fa-bolt text-warning"></i> NEW ORDER</h6>
                    
                    <select id="cat" class="neon-input" style="background: #111; padding:8px;" onchange="loadServices()"><option value="">Select Category</option></select>
                    <select id="svc" class="neon-input" style="background: #111; padding:8px;" onchange="updateServiceInfo()"><option value="">Select Service</option></select>
                    
                    <div class="p-2 mb-3 rounded bg-dark border border-secondary text-white-50" style="font-size: 0.85rem;">
                        <div class="d-flex justify-content-between mb-1">
                            <span id="lbl-rate" class="text-white fw-bold">Rate: ₹0</span>
                            <span id="lbl-time" class="text-info">Time: -</span>
                        </div>
                        <div id="lbl-desc" class="text-white-50" style="font-size: 0.75rem; font-style: italic;">Select a service...</div>
                    </div>

                    <input id="link" class="neon-input" style="padding:8px;" placeholder="Link (https://...)">
                    <input id="qty" type="number" class="neon-input" style="padding:8px;" placeholder="Quantity (Ex: 1000)" oninput="calcPrice()">
                    
                    <button class="btn-cyber mt-1" style="padding:8px;" onclick="placeOrder()">
                        CONFIRM <span id="btn-price" style="opacity:0.8;">(₹0.00)</span>
                    </button>
                </div>
            </div>

            <!-- ORDERS TAB -->
            <div id="tab-orders" class="tab-view" style="display:none;">
                <h6 class="text-center font-tech mb-2 text-secondary">ORDER HISTORY</h6>
                <div id="list-ord"><div class="text-center text-white-50 mt-5">Loading Orders...</div></div>
            </div>

            <!-- FUNDS TAB -->
            <div id="tab-funds" class="tab-view" style="display:none;">
                <div class="cyber-card text-center" style="border-bottom: 2px solid var(--secondary);">
                    <h5 class="font-tech mb-3 text-white">DEPOSIT FUNDS</h5>
                    
                    <div class="qr-frame mb-3">
                        <div class="qr-scan-line"></div>
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=mrankan@ptaxis&pn=InstaBooster" width="140" style="display:block; border-radius:5px;">
                    </div>
                    
                    <p class="small text-pink mb-3" style="letter-spacing:1px; font-weight:bold;">SCAN & PAY VIA UPI</p>

                    <div class="input-group mb-2">
                        <span class="input-group-text bg-dark border-secondary text-white"><i class="fas fa-receipt"></i></span>
                        <input id="f-tid" class="neon-input mb-0" placeholder="Transaction ID (UTR)" style="border-radius:0 5px 5px 0;">
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text bg-dark border-secondary text-white"><i class="fas fa-rupee-sign"></i></span>
                        <input id="f-amt" type="number" class="neon-input mb-0" placeholder="Amount" style="border-radius:0 5px 5px 0;">
                    </div>

                    <button class="btn-cyber" onclick="addFunds()">
                        <i class="fas fa-check-circle me-2"></i> VERIFY PAYMENT
                    </button>
                </div>
                
                <h6 class="font-tech text-secondary mt-4 mb-2 ps-1">TRANSACTION HISTORY</h6>
                <div id="list-fund"><div class="text-center text-white-50 mt-3">Loading History...</div></div>
            </div>
        </div>

        <div class="nav-dock">
            <button class="nav-item active" onclick="nav('home', this)"><i class="fas fa-rocket"></i></button>
            <button class="nav-item" onclick="nav('orders', this)"><i class="fas fa-file-alt"></i></button>
            <button class="nav-item" onclick="nav('funds', this)"><i class="fas fa-wallet"></i></button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyAmoVgzLDMb9hAHX9L_n5oKTSw5_Q9uz1Q",
  authDomain: "instabooster-a2e49.firebaseapp.com",
  databaseURL: "https://instabooster-a2e49-default-rtdb.firebaseio.com",
  projectId: "instabooster-a2e49",
  storageBucket: "instabooster-a2e49.firebasestorage.app",
  messagingSenderId: "69575684016",
  appId: "1:69575684016:web:89808125f3922d8469b075"
};
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.database();
        let user = null, allServices = [];

        auth.onAuthStateChanged(u => {
            if(u){
                user=u; 
                document.getElementById('scr-auth').style.display = 'none';
                document.getElementById('scr-app').style.display = 'flex';
                init();
            } else {
                document.getElementById('scr-app').style.display = 'none';
                document.getElementById('scr-auth').style.display = 'block';
            }
        });

        function nav(t, el){
            document.querySelectorAll('.tab-view').forEach(x=>x.style.display='none');
            document.getElementById('tab-'+t).style.display='block';
            document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
            el.classList.add('active');
        }

        function togAuth(t){
            document.getElementById('box-login').style.display = t=='log'?'block':'none';
            document.getElementById('box-reg').style.display = t=='reg'?'block':'none';
        }

        function login(){ auth.signInWithEmailAndPassword(document.getElementById('l-mail').value, document.getElementById('l-pass').value).catch(e=>alert(e.message)); }
        function register(){ 
            const e=document.getElementById('r-mail').value;
            auth.createUserWithEmailAndPassword(e, document.getElementById('r-pass').value)
            .then(c=>db.ref('users/'+c.user.uid).set({email:e,balance:0,spent:0}))
            .catch(e=>alert(e.message)); 
        }

        function init(){
            // SET EMAIL
            document.getElementById('d-email').innerText = user.email;

            // Stats
            db.ref('users/'+user.uid).on('value', s=>{
                const d=s.val()||{};
                document.getElementById('d-bal').innerText='₹'+(d.balance||0).toFixed(0);
                document.getElementById('d-spent').innerText='₹'+(d.spent||0).toFixed(0);
            });

            // Categories
            db.ref('categories').on('value', s=>{
                const c=document.getElementById('cat'); c.innerHTML='<option value="">Select Category</option>';
                s.forEach(x=>{
                    let name = x.val().name || x.val();
                    c.innerHTML += `<option value="${x.key}">${name}</option>`;
                });
            });

            // Services
            db.ref('services').on('value', s=>{
                allServices = [];
                s.forEach(x => { allServices.push({ key: x.key, ...x.val() }); });
            });

            // Orders
            db.ref('orders').on('value', s=>{
                const l=document.getElementById('list-ord'); 
                let myOrders = [];
                s.forEach(child => {
                    const ord = child.val();
                    if (ord.uid === user.uid) myOrders.push({key: child.key, ...ord});
                });
                myOrders.sort((a,b)=>(b.timestamp||0)-(a.timestamp||0));
                
                let h = '';
                myOrders.forEach(o=>{
                    let st=o.status, c=st=='Completed'?'text-success':(st=='Cancelled'?'text-danger':'text-warning');
                    h+=`<div class="cyber-card p-2 mb-2" style="border-bottom:1px solid #333; padding: 10px !important;">
                        <div class="d-flex justify-content-between">
                            <span class="${c} fw-bold small text-uppercase" style="font-size:0.7rem;">${st}</span>
                            <small class="text-white-50" style="font-size:0.7rem;">#${o.key.slice(-4)}</small>
                        </div>
                        <h6 class="text-white mt-1 mb-1" style="font-size:0.85rem;">${o.serviceName}</h6>
                        <div class="d-flex justify-content-between pt-1">
                            <span class="small text-white-50" style="font-size:0.7rem;">Qty: ${o.quantity}</span>
                            <span class="text-glow fw-bold small">₹${o.charge}</span>
                        </div>
                    </div>`;
                });
                l.innerHTML = h || '<div class="text-center text-white-50 mt-5">No Orders Found</div>';
            });

            // Funds
            db.ref('funds').on('value', s => {
                const l = document.getElementById('list-fund'); 
                let myFunds = [];
                s.forEach(child => {
                    const fund = child.val();
                    if (fund.uid === user.uid) myFunds.push(fund);
                });
                myFunds.sort((a,b)=>(b.timestamp||0)-(a.timestamp||0));

                let h = '';
                myFunds.forEach(f => {
                    let stClass = f.status === 'Approved' ? 'approved' : (f.status === 'Rejected' ? 'rejected' : 'pending');
                    let stColor = f.status === 'Approved' ? '#00ff88' : (f.status === 'Rejected' ? '#ff0055' : '#ffcc00');
                    let icon = f.status === 'Approved' ? 'fa-check' : (f.status === 'Rejected' ? 'fa-times' : 'fa-clock');

                    h += `
                    <div class="fund-item ${stClass}">
                        <div>
                            <div class="fw-bold text-white" style="font-size:1.1rem;">₹${f.amount}</div>
                            <div class="small text-white-50" style="font-size:0.75rem;">ID: ${f.txnId}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:${stColor}; font-weight:bold; font-size:0.8rem; text-transform:uppercase;">
                                <i class="fas ${icon} me-1"></i> ${f.status}
                            </div>
                            <div class="small text-white-50" style="font-size:0.65rem;">${new Date(f.timestamp).toLocaleDateString()}</div>
                        </div>
                    </div>`;
                });
                l.innerHTML = h || '<div class="text-center text-white-50 mt-3">No transactions found</div>';
            });
        }

        function loadServices(){
            const catId = document.getElementById('cat').value;
            const svcSelect = document.getElementById('svc');
            svcSelect.innerHTML = '<option value="">Loading...</option>';
            const filteredServices = allServices.filter(s => s.catId === catId);
            svcSelect.innerHTML = '<option value="">Select Service</option>';
            if(filteredServices.length > 0){
                filteredServices.forEach(s => { svcSelect.innerHTML += `<option value="${s.key}">${s.name} - ₹${s.rate}</option>`; });
            } else {
                svcSelect.innerHTML = '<option value="">No services found</option>';
            }
        }

        function updateServiceInfo(){
            const svcKey = document.getElementById('svc').value;
            const service = allServices.find(s => s.key === svcKey);
            if(service){
                document.getElementById('lbl-rate').innerText = `Rate: ₹${service.rate}`;
                document.getElementById('lbl-time').innerText = `Time: ${service.time || 'N/A'}`;
                document.getElementById('lbl-desc').innerText = service.desc || 'No description available.';
                calcPrice();
            } else {
                document.getElementById('lbl-rate').innerText = `Rate: ₹0`;
                document.getElementById('lbl-time').innerText = `Time: -`;
                document.getElementById('lbl-desc').innerText = 'Select a service...';
            }
        }

        function calcPrice(){
            const svcKey = document.getElementById('svc').value;
            const qty = document.getElementById('qty').value;
            const service = allServices.find(s => s.key === svcKey);
            if(service && qty){
                const price = (qty / 1000) * service.rate;
                document.getElementById('btn-price').innerText = `(₹${price.toFixed(2)})`;
            } else {
                document.getElementById('btn-price').innerText = `(₹0.00)`;
            }
        }

        function placeOrder(){
            const svcKey = document.getElementById('svc').value;
            const qty = document.getElementById('qty').value;
            const link = document.getElementById('link').value;
            const service = allServices.find(s => s.key === svcKey);
            if(!service || !qty || !link) return alert("Please fill all fields!");
            
            const cost = ((qty / 1000) * service.rate).toFixed(2);
            db.ref('users/'+user.uid).once('value', sn=>{
                const bal = sn.val().balance || 0;
                if(parseFloat(bal) < parseFloat(cost)) return alert("Insufficient Balance!");
                
                const nr = db.ref('orders').push();
                const updates = {};
                updates['orders/'+nr.key] = {
                    key: nr.key, uid: user.uid, serviceName: service.name, serviceId: service.key, link: link, quantity: qty, charge: cost, status: 'Pending', timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                updates['users/'+user.uid+'/balance'] = parseFloat(bal) - parseFloat(cost);
                updates['users/'+user.uid+'/spent'] = (sn.val().spent||0) + parseFloat(cost);
                db.ref().update(updates).then(()=>{ 
                    alert("Order Placed Successfully!"); 
                    nav('orders', document.querySelectorAll('.nav-item')[1]);
                    document.getElementById('link').value = '';
                    document.getElementById('qty').value = '';
                    document.getElementById('btn-price').innerText = '(₹0.00)';
                });
            });
        }

        function addFunds(){
            const t = document.getElementById('f-tid').value;
            const a = document.getElementById('f-amt').value;
            if(!t || !a) return alert("Fill all fields");
            const nr = db.ref('funds').push();
            nr.set({
                key: nr.key, uid: user.uid, email: user.email, txnId: t, amount: parseFloat(a), status: 'Pending', timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(()=>{ 
                alert("Request Sent! Wait for approval."); 
                document.getElementById('f-tid').value=''; 
                document.getElementById('f-amt').value='';
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>